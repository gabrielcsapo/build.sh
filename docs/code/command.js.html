<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: command.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: command.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { spawn } = require('child_process')

class Command {
  /**
   * Class used to define shell commands be executed in the pipeline
   * @class Command
   * @param  {Pipeline}    parent  [description]
   * @param  {String}    command [description]
   */
  constructor (parent, command) {
    /**
     * The parent pipeline this command belongs too
     * @type {Pipline}
     */
    this.parent = parent
    /**
     * The shell command that this command will execute
     * @type {String}
     */
    this.command = command
    /**
     * The output from the running a sub-process with the shell command
     * @type {Array&lt;Object>}
     */
    this.output = []
    /**
     * The state of the command (unknown, skipped, fail, success)
     * @type {String}
     */
    this.state = 'unknown'
    /**
     * The time in MS that the command took to execute
     * @type {String}
     */
    this.time = 0
    /**
     * A unique identifier
     * @type {Number}
     */
    this.id = Date.now() + Math.random().toString(36).substr(2, 10)
  }
  /**
   * Runs the command using the passed in shell script as the command to run
   * @memberof Command
   * @method run
   * @param  {Promise} [description]
   */
  run () {
    return new Promise((resolve, reject) => {
      const start = process.hrtime()

      const child = spawn(this.command, {
        cwd: process.cwd(),
        shell: '/bin/bash'
      })

      child.stdout.on('data', (m) => {
        this.output.push({
          type: 'stdout',
          content: m.toString('utf8'),
          date: new Date()
        })
      })

      child.stderr.on('data', (m) => {
        this.output.push({
          type: 'stderr',
          content: m.toString('utf8'),
          date: new Date()
        })
      })

      child.on('exit', (code) => {
        const end = process.hrtime(start)

        this.state = code === 0 ? 'success' : 'fail'
        this.time = ((end[0] * 1e9) + end[1]) / 1e6
        resolve(this.state)
      })
    })
  }
  /**
   * returns information pertaining to the command
   * @memberof Command
   * @method getReport
   * @return {Object}
   */
  getReport () {
    return {
      type: 'command',
      command: this.command,
      output: this.output,
      state: this.state,
      time: this.time,
      id: this.id
    }
  }
}

module.exports = Command
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-lib_util.html">lib/util</a></li></ul><h3>Classes</h3><ul><li><a href="Command.html">Command</a></li><li><a href="Compile.html">Compile</a></li><li><a href="Git.html">Git</a></li><li><a href="Pipeline.html">Pipeline</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
